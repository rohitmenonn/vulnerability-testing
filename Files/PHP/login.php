<?php
 
$connectDB = mysqli_connect("localhost", "root", "password") or die('Could not connect to DB: '.mysqli_error());
$db = mysqli_select_db($connectDB,"library");
if(!$db){
    echo "Error Number: ".mysqli_errorno($connectDB);
    echo "Error: ".mysqli_error($connectDB);
}

$username = $_POST['username'];
$password = $_POST['password'];

try{
    $query = "select password from users where username = '$username'";
    $result = mysqli_query($connectDB,$query);
    while($row = mysqli_fetch_array($result)){
        if($password === $row[0]){
            session_start();
            if(!isset($_SESSION['user'])){
                $_SESSION['user'] = $username;
                $_SESSION['views'] = 0;
            }
            if(isset($_SESSION['user']) && isset($_SESSION['views'])){
                $_SESSION['views'] += 1;
                echo "Logged in as: ". $_SESSION['user'], "<br>";
                echo "Number of times viewed: " . $_SESSION['views'];
            }
            setcookie('user',$username,time() + 60*60*24);
            if(isset($_COOKIE['user'])){
                echo "Obtaining user from cookie: ". $_COOKIE['user'];
            }
            else{
                echo "No cookies have been set";
            }
            header("Location: home.php");
        }else{
            echo "Not logged in <br>";
            echo "<a href=" ."signup.php" .">Register</a>";
        }
    }
}catch(Exception $e){
    echo "An error has occured";
}

?>
